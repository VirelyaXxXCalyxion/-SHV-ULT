---
import type { CollectionEntry } from "astro:content";

const { entry } = Astro.props as { entry: CollectionEntry<"scrolls"> };
const slug = entry.slug;
const title = entry.data.title;
const cover = entry.data.image;
const tags = entry.data.tags;
const excerpt = entry.data.summary;
const author = entry.data.author;

// Handle both created and pubDate fields
const getDate = (data: any) => {
  const dateValue = data.created || data.pubDate;
  return dateValue ? new Date(dateValue).toLocaleDateString() : null;
};

const created = getDate(entry.data);
const href = `/vault-of-flame/scrolls/${slug}/`;
---

<article class="scroll-card">
  {cover && (
    <a class="thumb" href={href} aria-label={`Open ${title}`}>
      <img src={cover} alt={title} loading="lazy" decoding="async" />
    </a>
  )}

  <header class="meta">
    <h3><a href={href}>{title}</a></h3>
    <div class="byline">
      {author && <span class="author">by {author}</span>}
      {created && <time>{created}</time>}
    </div>
  </header>

  {excerpt && <p class="excerpt">{excerpt}</p>}

  {tags && (
    <ul class="tags">
      {tags.map((t: string) => <li>{t}</li>)}
    </ul>
  )}
</article>

<style>
.scroll-card { 
  border-radius: 14px; 
  padding: 0.75rem; 
  background: rgba(255,255,255,0.02); 
  border: 1px solid rgba(255,255,255,0.06);
  max-width: 320px;
}

.thumb {
  width: 50%;
  aspect-ratio: 16 / 9;
  border-radius: 12px;
  overflow: hidden;
  display: block;
  border: 1px solid rgba(255,255,255,0.07);
  background: #0b0b0b;
  text-decoration: none;
}

.thumb img {
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display: block;
  transition: transform 0.2s ease;
}

.thumb:hover img {
  transform: scale(1.05);
}

.meta { 
  display: flex; 
  flex-direction: column;
  gap: .35rem; 
  margin-top: .6rem; 
}

.meta h3 { 
  margin: 0; 
  font-size: 1.05rem; 
  font-weight: 600; 
}

.meta h3 a { 
  color: #e6b357; 
  text-decoration: none; 
}

.meta h3 a:hover { 
  text-decoration: underline; 
}

.byline {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 0.8rem;
  color: #a3a3b2;
}

.author {
  font-style: italic;
}

.excerpt { 
  font-size: 0.9rem; 
  color: #a3a3b2; 
  margin: .5rem 0 .75rem; 
  line-height: 1.5;
}

.tags { 
  list-style: none; 
  padding: 0; 
  margin: 0; 
  display: flex; 
  flex-wrap: wrap; 
  gap: .4rem; 
}

.tags li {
  background: rgba(255, 122, 26, 0.12);
  border: 1px solid rgba(255, 122, 26, 0.35);
  border-radius: 999px;
  padding: 0.15rem 0.5rem;
  font-size: 0.7rem;
  color: #d7d7df;
}
</style>
