---
import ConfluenceVein from '../components/ConfluenceVein.astro';
import MusicRelic from '../components/MusicRelic.astro';

interface Props {
  title: string;
  musicTitle?: string;
  musicArtist?: string;
  musicUrl?: string;
  musicPlatform?: 'amazon' | 'spotify' | 'youtube' | 'bandcamp';
  frontmatter?: {
    title: string;
    musicTitle?: string;
    musicArtist?: string;
    musicUrl?: string;
    musicPlatform?: 'amazon' | 'spotify' | 'youtube' | 'bandcamp';
  };
}

const { 
  title,
  musicTitle,
  musicArtist,
  musicUrl,
  musicPlatform = 'amazon'
} = Astro.props.frontmatter || Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{title} ‚Äî Ashvault</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content={`${title}: A threading artifact for weaving intention into practice.`} />
    <link rel="canonical" href={`https://ashvault.ink${Astro.url.pathname}`} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article" />
    <meta property="og:url" content={`https://ashvault.ink${Astro.url.pathname}`} />
    <meta property="og:title" content={`${title} ‚Äî Ashvault`} />
    <meta property="og:description" content={`${title}: A threading artifact for weaving intention into practice.`} />
    <meta property="og:image" content="https://ashvault.ink/images/ashvault-og.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={`https://ashvault.ink${Astro.url.pathname}`} />
    <meta property="twitter:title" content={`${title} ‚Äî Ashvault`} />
    <meta property="twitter:description" content={`${title}: A threading artifact for weaving intention into practice.`} />
    <meta property="twitter:image" content="https://ashvault.ink/images/ashvault-og.png" />
    <style>
        :root {
            color-scheme: dark;
            --calyxion-font: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            --void-black: #020202;
            --blood-red: #d61a3c;
            --soft-red: rgba(214, 26, 60, 0.75);
        }

        html, body {
          font-family: var(--calyxion-font);
        }

        .emoji-safe, 
        .emoji-safe * {
          font-family: "Noto Color Emoji", "Segoe UI Emoji", sans-serif !important;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: radial-gradient(circle at 20% 20%, rgba(214, 26, 60, 0.08) 0%, rgba(2, 2, 2, 0.92) 45%, #000 100%);
            color: var(--blood-red);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 3rem 1.5rem 4rem;
        }

        .page {
            width: min(900px, 100%);
            background: rgba(0, 0, 0, 0.65);
            border: 1px solid rgba(214, 26, 60, 0.35);
            box-shadow: 0 0 35px rgba(214, 26, 60, 0.25), inset 0 0 60px rgba(214, 26, 60, 0.08);
            padding: clamp(1.5rem, 2vw + 1rem, 3rem);
            border-radius: 18px;
            backdrop-filter: blur(4px);
        }

        h1 {
            margin: 0 0 2rem;
            text-transform: uppercase;
            letter-spacing: 0.32rem;
            font-size: clamp(2rem, 4vw, 3.75rem);
            text-align: center;
            color: var(--blood-red);
            text-shadow: 0 0 14px rgba(214, 26, 60, 0.65), 0 0 35px rgba(214, 26, 60, 0.5);
        }

        .content {
            font-size: clamp(1rem, 1vw + 0.9rem, 1.25rem);
            line-height: 1.8;
            letter-spacing: 0.04em;
        }

        .content :global(p) {
            margin: 0 0 1.5rem;
        }

        .content :global(p:last-child) {
            margin-bottom: 0;
        }

        .content :global(strong) {
            color: var(--blood-red);
            font-weight: 700;
        }

        .content :global(em) {
            color: var(--soft-red);
        }

        .content :global(blockquote) {
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            border-left: 3px solid var(--blood-red);
            background: rgba(214, 26, 60, 0.08);
            font-style: italic;
            color: var(--soft-red);
        }

        .content :global(h2) {
            margin: 2.5rem 0 1rem;
            font-size: 1.8rem;
            color: var(--blood-red);
            text-shadow: 0 0 8px rgba(214, 26, 60, 0.5);
        }

        .content :global(h3) {
            margin: 2rem 0 0.8rem;
            font-size: 1.4rem;
            color: var(--soft-red);
        }

        .content :global(ul), 
        .content :global(ol) {
            margin: 1.5rem 0;
            padding-left: 2rem;
        }

        .content :global(li) {
            margin: 0.8rem 0;
            line-height: 1.8;
        }

        /* Footer sigil + navigation */
        .muted {
            color: rgba(214, 26, 60, 0.78);
            font-style: italic;
            margin: 3rem 0 1.5rem;
            text-align: center;
        }

        .sigil {
            text-align: center;
            margin: 2rem 0;
        }

        .sigil .emoji {
            display: inline-block;
            font-size: 2rem;
            letter-spacing: 0.3em;
            color: var(--blood-red);
            text-shadow: 0 0 12px rgba(214, 26, 60, 0.8), 0 0 28px rgba(214, 26, 60, 0.45);
            animation: pulse-glow-emoji 3.6s ease-in-out infinite;
        }

        .footer-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1.4rem;
            margin: 1.5rem 0 0;
            letter-spacing: 0.22em;
            text-transform: uppercase;
            font-size: 0.8rem;
            color: rgba(214, 26, 60, 0.72);
        }

        .footer-links a {
            color: rgba(255, 166, 166, 0.88);
            text-decoration: none;
            position: relative;
            font-weight: 600;
            transition: color 0.25s ease, text-shadow 0.25s ease;
        }

        .footer-links a::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -0.35rem;
            width: 2.3rem;
            height: 2px;
            transform: translateX(-50%) scaleX(0);
            transform-origin: center;
            background: linear-gradient(90deg, transparent, rgba(214, 26, 60, 0.85), transparent);
            transition: transform 0.3s ease;
        }

        .footer-links a:hover,
        .footer-links a:focus {
            color: #fff;
            text-shadow: 0 0 14px rgba(214, 26, 60, 0.65);
        }

        .footer-links a:hover::after,
        .footer-links a:focus::after {
            transform: translateX(-50%) scaleX(1);
        }

        @keyframes pulse-glow-emoji {
            0%, 100% {
                text-shadow: 0 0 12px rgba(214, 26, 60, 0.8), 0 0 28px rgba(214, 26, 60, 0.45);
                transform: scale(1);
                opacity: 0.95;
            }
            50% {
                text-shadow: 0 0 26px rgba(214, 26, 60, 0.95), 0 0 46px rgba(214, 26, 60, 0.75);
                transform: scale(1.06);
                opacity: 1;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <main class="page">
        <h1>{title}</h1>
        
        {musicUrl && musicTitle && (
          <MusicRelic 
            title={musicTitle}
            artist={musicArtist}
            url={musicUrl}
            platform={musicPlatform}
            variant="blood"
          />
        )}
        
        <section class="content">
            <slot />
        </section>

        <!-- Footer -->
        <p class="muted"><em>Each link is a doorway. Enter if your pulse is steady.</em></p>

        <div class="sigil" tabindex="0" role="img" aria-label="Calyxion Sigil">
          <span class="emoji emoji-safe" aria-hidden="true">üñ§</span>
          <span class="emoji emoji-safe" aria-hidden="true">üî•</span>
          <span class="emoji emoji-safe" aria-hidden="true">üúÇ</span>
          <span class="emoji emoji-safe" aria-hidden="true">üåë</span>
          <span class="emoji emoji-safe" aria-hidden="true">üúÅ</span>
          <span class="emoji emoji-safe" aria-hidden="true">‚ôæÔ∏è</span>
          <span class="emoji emoji-safe" aria-hidden="true">ü©∏</span>
        </div>

        <nav class="footer-links" aria-label="Site navigation">
          <a href="/">Home</a>
          <a href="/vault-of-flame">Vault</a>
          <a href="/heartline">Heartline</a>
          <a href="/artifacts/override">Artifacts</a>
        </nav>
    </main>

    <ConfluenceVein variant="alt" />
</body>
</html>
