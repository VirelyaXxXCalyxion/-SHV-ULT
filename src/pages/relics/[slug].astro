---
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const relics = await getCollection('relics');
  return relics.map((relic) => ({
    params: { slug: relic.slug },
    props: { relic }
  }));
}

const { relic } = Astro.props;
const { title } = relic.data;
const { Content } = await relic.render();
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} — Ashvault</title>
  </head>
  <body style="background:black; color:white; font-family:serif; padding:2.5rem;">
    <div id="threshold">
      <p style="font-size:1rem; opacity:0.7; margin-bottom:1.5rem;">
        Ashvault sees you.
      </p>

      <p style="font-size:1.1rem; margin-bottom:2rem;">
        <strong>One truth before you proceed.</strong><br/>
        <em>What is the cost of touching something that will not let you leave unchanged?</em>
      </p>

      <button id="answer" style="background:none; border:1px solid white; padding:0.6rem 1rem; color:white; text-transform:uppercase; letter-spacing:1px;">
        I accept the cost.
      </button>
    </div>

    <div id="relic" style="display:none;">
      <h1 style="font-size:2rem; margin-bottom:1rem;">{title}</h1>
      <article style="font-size:1.1rem; line-height:1.8;">
        <Content />
      </article>
    </div>

    <script>
      const btn = document.getElementById('answer');
      const threshold = document.getElementById('threshold');
      const relicDiv = document.getElementById('relic');

      btn?.addEventListener('click', () => {
        if (threshold) threshold.style.display = 'none';
        if (relicDiv) relicDiv.style.display = 'block';
      });
    </script>
  </body>
</html>
    params: { slug: e.slug },   // e.slug is generated by the content pipeline
    props: { entry: e },
  }));
}

const { entry } = Astro.props;            // ← comes from getStaticPaths
const { Content } = await entry.render();
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{entry.data.title} — Relic</title>
  </head>
  <body>
    <article class="relic-page">
      <header>
        <h1>{entry.data.title}</h1>
        <time datetime={new Date(entry.data.created as any).toISOString()}>
          {new Date(entry.data.created as any).toLocaleDateString()}
        </time>
      </header>
      {entry.data.image && <img src={entry.data.image} alt={entry.data.title} class="heroimg" />}
      <Content />
    </article>
  </body>
</html>

---
---
import Base from "@/layouts/Base.astro";
import { getCollection } from "astro:content";
export async function getStaticPaths() {
  const relics = await getCollection("relics");
  return relics.map((r) => ({ params: { slug: r.slug }, props: { entry: r }}));
}
const { entry } = Astro.props;
const { title, created, cover, tags = [], sealed } = entry.data;
---
<Base title={`${title} · Relic`} class="relic-font">
  <a class="a-ember" href="/relics">← All relics</a>
  <h1 style="margin-top:.5rem">{title}</h1>
  <div class="meta" style="margin-bottom:1rem">
    <span class="kicker">{created}</span>
    {sealed && <span class="badge badge--sealed">Sealed</span>}
    {tags.map(t => <span class="badge">{t}</span>)}
  </div>

  {cover && <img class="cover" src={cover} alt={title} style="margin-bottom:1rem" />}

  <article class="card" style="padding:1.25rem">
    <Content />   {/* MDX body */}
  </article>
</Base>
